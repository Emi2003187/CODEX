{% extends "base.html" %}
{% load static %}
{% block title %}Editar paciente{% endblock %}

{% block content %}
<div class="container mt-5">
  <div class="card shadow-sm border-0 rounded-4">
    <div class="card-header bg-primary text-white rounded-top-4">
      <h4 class="mb-0"><i class="bi bi-pencil-square"></i> Editar Paciente</h4>
    </div>
    <div class="card-body px-4">
      <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="row">
          <!-- Columna izquierda: imagen -->
          <div class="col-md-4 text-center">
            <div class="mb-3">
              <img id="preview-img"
                   src="{% if form.instance.foto and form.instance.foto.url %}{{ form.instance.foto.url }}{% else %}{% static 'img/default_user.png' %}{% endif %}"
                   class="img-thumbnail rounded shadow" width="180" height="180" style="object-fit: cover;" alt="Foto de perfil">
            </div>
            <div class="mb-3">
              {{ form.foto.label_tag }}
              {{ form.foto }}
              {% for error in form.foto.errors %}
                <div class="text-danger small">{{ error }}</div>
              {% endfor %}
            </div>
          </div>

          <!-- Columna derecha -->
          <div class="col-md-8">
            <div class="row">
              <div class="col-md-6 mb-3">
                {{ form.nombre_completo.label_tag }} {{ form.nombre_completo }}
                {% for error in form.nombre_completo.errors %}
                  <div class="text-danger small">{{ error }}</div>
                {% endfor %}
              </div>
              <div class="col-md-6 mb-3">
                {{ form.fecha_nacimiento.label_tag }} {{ form.fecha_nacimiento }}
                {% for error in form.fecha_nacimiento.errors %}
                  <div class="text-danger small">{{ error }}</div>
                {% endfor %}
              </div>
              <div class="col-md-6 mb-3">
                {{ form.sexo.label_tag }} {{ form.sexo }}
                {% for error in form.sexo.errors %}
                  <div class="text-danger small">{{ error }}</div>
                {% endfor %}
              </div>
              <div class="col-md-6 mb-3">
                {{ form.telefono.label_tag }} {{ form.telefono }}
                {% for error in form.telefono.errors %}
                  <div class="text-danger small">{{ error }}</div>
                {% endfor %}
              </div>
              <div class="col-md-6 mb-3">
                {{ form.correo.label_tag }} {{ form.correo }}
                {% for error in form.correo.errors %}
                  <div class="text-danger small">{{ error }}</div>
                {% endfor %}
              </div>
              <div class="col-12 mb-3">
                {{ form.direccion.label_tag }} {{ form.direccion }}
                {% for error in form.direccion.errors %}
                  <div class="text-danger small">{{ error }}</div>
                {% endfor %}
              </div>
              {% if not form.consultorio.is_hidden %}
              <div class="col-md-6 mb-3">
                {{ form.consultorio.label_tag }} {{ form.consultorio }}
                {% for error in form.consultorio.errors %}
                  <div class="text-danger small">{{ error }}</div>
                {% endfor %}
              </div>
              {% endif %}
            </div>
          </div>
        </div>

        <!-- Botones -->
        <div class="mt-4 d-flex justify-content-end gap-2">
          <a href="{% url 'pacientes_lista' %}" class="btn btn-secondary px-4">Cancelar</a>
          <button type="submit" class="btn btn-primary px-4">Actualizar</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Script de vista previa -->
<script>
  const fotoInput = document.getElementById("id_foto");
  const previewImg = document.getElementById("preview-img");

  if (fotoInput) {
    fotoInput.addEventListener("change", function () {
      const file = this.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          previewImg.src = e.target.result;
        };
        reader.readAsDataURL(file);
      }
    });
  }
</script>
{% endblock %}
