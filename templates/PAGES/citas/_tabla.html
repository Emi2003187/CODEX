    <!-- CONTENIDO DE PESTAÑAS -->
    <div class="tab-content" id="citaTabsContent">
        <!-- Tab: Sin Asignar -->
        <div class="tab-pane fade show active" id="sin-asignar" role="tabpanel">
            {% if grupos.sin_asignar %}
                <div class="row">
                    {% for cita in grupos.sin_asignar %}
                    <div class="col-lg-6 col-xl-4 mb-4">
                        <div class="card cita-card estado-{{ cita.estado }} prioridad-{{ cita.prioridad }} h-100">
                            <div class="status-indicator {{ cita.estado }}"></div>
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h6 class="mb-0">
                                    <i class="bi bi-person me-1"></i>
                                    {{ cita.paciente.nombre_completo }}
                                </h6>
                                <span class="badge badge-estado
                                    {% if cita.estado == 'programada' %}bg-primary
                                    {% elif cita.estado == 'confirmada' %}bg-success
                                    {% elif cita.estado == 'en_espera' %}bg-warning
                                    {% elif cita.estado == 'en_atencion' %}bg-info
                                    {% elif cita.estado == 'completada' %}bg-success
                                    {% elif cita.estado == 'cancelada' %}bg-danger
                                    {% else %}bg-secondary{% endif %}">
                                    {{ cita.get_estado_display }}
                                </span>
                            </div>
                            <div class="card-body">
                                <div class="row mb-2">
                                    <div class="col-6">
                                        <small class="text-muted">Fecha</small>
                                        <div class="fw-bold">{{ cita.fecha_hora|date:"d/m/Y" }}</div>
                                    </div>
                                    <div class="col-6">
                                        <small class="text-muted">Hora</small>
                                        <div class="fw-bold">{{ cita.fecha_hora|time:"H:i" }}</div>
                                    </div>
                                </div>
                                
                                <div class="mb-2">
                                    <small class="text-muted">Médico</small>
                                    <div>
                                        {% if cita.medico_asignado %}
                                            <span class="medico-asignado">{{ cita.medico_asignado.get_full_name }}</span>
                                        {% else %}
                                            <span class="sin-asignar">Sin asignar</span>
                                        {% endif %}
                                    </div>
                                </div>
                                
                                <div class="row mb-2">
                                    <div class="col-6">
                                        <small class="text-muted">Tipo</small>
                                        <div>{{ cita.get_tipo_cita_display }}</div>
                                    </div>
                                    <div class="col-6">
                                        <small class="text-muted">Duración</small>
                                        <div>{{ cita.duracion }} min</div>
                                    </div>
                                </div>
                                
                                {% if cita.motivo %}
                                <div class="mb-2">
                                    <small class="text-muted">Motivo</small>
                                    <div class="text-truncate">{{ cita.motivo }}</div>
                                </div>
                                {% endif %}
                                
                                <div class="d-flex align-items-center justify-content-between">
                                    <small class="text-muted">
                                        <i class="bi bi-hash"></i>{{ cita.numero_cita }}
                                    </small>
                                    <div class="badge
                                        {% if cita.prioridad == 'urgente' %}bg-danger
                                        {% elif cita.prioridad == 'alta' %}bg-warning
                                        {% elif cita.prioridad == 'normal' %}bg-success
                                        {% else %}bg-secondary{% endif %}">
                                        {{ cita.get_prioridad_display }}
                                    </div>
                                </div>
                            </div>
                            <div class="card-footer">
                                <div class="cita-actions">
                                    <a href="{% url 'citas_detalle' cita.pk %}"
                                       class="btn btn-sm btn-outline-info btn-action">
                                        <i class="bi bi-eye"></i> Ver
                                    </a>
                                    {% if usuario.rol == 'medico' %}
                                    <a href="{% url 'tomar_cita' cita.id %}"
                                       class="btn btn-sm btn-success btn-action">
                                        <i class="bi bi-hand-index"></i> Tomar
                                    </a>
                                    {% endif %}
                                    {% if permisos.puede_asignar %}
                                    <button type="button" class="btn btn-sm btn-primary btn-action"
                                            onclick="asignarMedico('{{ cita.pk }}')">
                                        <i class="bi bi-person-plus"></i> Asignar
                                    </button>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <i class="bi bi-calendar-check display-1"></i>
                    <h4>No hay citas sin asignar</h4>
                    <p>Todas las citas han sido asignadas a médicos.</p>
                </div>
            {% endif %}
        </div>

        <!-- Tab: Asignadas -->
        <div class="tab-pane fade" id="asignadas" role="tabpanel">
            {% if grupos.asignadas %}
                <div class="row">
                    {% for cita in grupos.asignadas %}
                    <div class="col-lg-6 col-xl-4 mb-4">
                        <div class="card cita-card estado-{{ cita.estado }} prioridad-{{ cita.prioridad }} h-100">
                            <div class="status-indicator {{ cita.estado }}"></div>
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h6 class="mb-0">
                                    <i class="bi bi-person me-1"></i>
                                    {{ cita.paciente.nombre_completo }}
                                </h6>
                                <span class="badge badge-estado
                                    {% if cita.estado == 'programada' %}bg-primary
                                    {% elif cita.estado == 'confirmada' %}bg-success
                                    {% elif cita.estado == 'en_espera' %}bg-warning
                                    {% elif cita.estado == 'en_atencion' %}bg-info
                                    {% elif cita.estado == 'completada' %}bg-success
                                    {% elif cita.estado == 'cancelada' %}bg-danger
                                    {% else %}bg-secondary{% endif %}">
                                    {{ cita.get_estado_display }}
                                </span>
                            </div>
                            <div class="card-body">
                                <div class="row mb-2">
                                    <div class="col-6">
                                        <small class="text-muted">Fecha</small>
                                        <div class="fw-bold">{{ cita.fecha_hora|date:"d/m/Y" }}</div>
                                    </div>
                                    <div class="col-6">
                                        <small class="text-muted">Hora</small>
                                        <div class="fw-bold">{{ cita.fecha_hora|time:"H:i" }}</div>
                                    </div>
                                </div>
                                
                                <div class="mb-2">
                                    <small class="text-muted">Médico Asignado</small>
                                    <div>
                                        <span class="medico-asignado">{{ cita.medico_asignado.get_full_name }}</span>
                                        {% if cita.fecha_asignacion_medico %}
                                        <small class="text-muted d-block">
                                            Asignado: {{ cita.fecha_asignacion_medico|date:"d/m/Y H:i" }}
                                        </small>
                                        {% endif %}
                                    </div>
                                </div>
                                
                                <div class="row mb-2">
                                    <div class="col-6">
                                        <small class="text-muted">Tipo</small>
                                        <div>{{ cita.get_tipo_cita_display }}</div>
                                    </div>
                                    <div class="col-6">
                                        <small class="text-muted">Duración</small>
                                        <div>{{ cita.duracion }} min</div>
                                    </div>
                                </div>
                                
                                {% if cita.motivo %}
                                <div class="mb-2">
                                    <small class="text-muted">Motivo</small>
                                    <div class="text-truncate">{{ cita.motivo }}</div>
                                </div>
                                {% endif %}
                                
                                <div class="d-flex align-items-center justify-content-between">
                                    <small class="text-muted">
                                        <i class="bi bi-hash"></i>{{ cita.numero_cita }}
                                    </small>
                                    <div class="badge
                                        {% if cita.prioridad == 'urgente' %}bg-danger
                                        {% elif cita.prioridad == 'alta' %}bg-warning
                                        {% elif cita.prioridad == 'normal' %}bg-success
                                        {% else %}bg-secondary{% endif %}">
                                        {{ cita.get_prioridad_display }}
                                    </div>
                                </div>
                            </div>
                            <div class="card-footer">
                                <div class="cita-actions">
                                    <a href="{% url 'citas_detalle' cita.pk %}"
                                       class="btn btn-sm btn-outline-info btn-action">
                                        <i class="bi bi-eye"></i> Ver
                                    </a>
                                    
                                    {% if permisos.puede_liberar and cita.medico_asignado %}
                                    <a href="{% url 'liberar_cita' cita.id %}"
                                       class="btn btn-sm btn-warning btn-action">
                                        <i class="bi bi-unlock"></i> Liberar
                                    </a>
                                    {% endif %}
                                    
                                    <!-- Lógica para mostrar botón Iniciar o Ver Consulta -->
                                    {% if cita.medico_asignado and cita.estado in 'programada,confirmada,en_espera' %}
                                        {% if cita.consulta %}
                                            <!-- Si ya tiene consulta, mostrar botón para ir a la consulta -->
                                            <a href="{% url 'consulta_detalle' cita.consulta.id %}"
                                               class="btn btn-sm btn-info btn-action">
                                                <i class="bi bi-clipboard-pulse"></i> Ver Consulta
                                            </a>
                                        {% else %}
                                            <!-- Si no tiene consulta, mostrar botón Iniciar -->
                                            <form method="post" action="{% url 'citas_crear_desde_cita' cita.id %}" class="d-inline">
                                                {% csrf_token %}
                                                <button type="submit" class="btn btn-sm btn-success btn-action">
                                                    <i class="bi bi-play"></i> Iniciar
                                                </button>
                                            </form>
                                        {% endif %}
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <i class="bi bi-person-check display-1"></i>
                    <h4>No hay citas asignadas</h4>
                    <p>Las citas asignadas aparecerán aquí.</p>
                </div>
            {% endif %}
        </div>

        <!-- Tab: Completadas -->
        <div class="tab-pane fade" id="completadas" role="tabpanel">
            {% if grupos.completadas %}
                <div class="row">
                    {% for cita in grupos.completadas %}
                    <div class="col-lg-6 col-xl-4 mb-4">
                        <div class="card cita-card estado-completada h-100">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h6 class="mb-0">
                                    <i class="bi bi-person me-1"></i>
                                    {{ cita.paciente.nombre_completo }}
                                </h6>
                                <span class="badge bg-success">Completada</span>
                            </div>
                            <div class="card-body">
                                <div class="row mb-2">
                                    <div class="col-6">
                                        <small class="text-muted">Fecha</small>
                                        <div class="fw-bold">{{ cita.fecha_hora|date:"d/m/Y" }}</div>
                                    </div>
                                    <div class="col-6">
                                        <small class="text-muted">Hora</small>
                                        <div class="fw-bold">{{ cita.fecha_hora|time:"H:i" }}</div>
                                    </div>
                                </div>
                                
                                <div class="mb-2">
                                    <small class="text-muted">Médico</small>
                                    <div>{{ cita.medico_asignado.get_full_name|default:"No asignado" }}</div>
                                </div>
                                
                                <div class="d-flex align-items-center justify-content-between">
                                    <small class="text-muted">
                                        <i class="bi bi-hash"></i>{{ cita.numero_cita }}
                                    </small>
                                    <div class="badge bg-success">
                                        <i class="bi bi-check-circle"></i> Finalizada
                                    </div>
                                </div>
                            </div>
                            <div class="card-footer">
                                <div class="cita-actions">
                                    <a href="{% url 'citas_detalle' cita.pk %}"
                                       class="btn btn-sm btn-outline-info btn-action">
                                        <i class="bi bi-eye"></i> Ver Detalles
                                    </a>
                                    {% if cita.consulta %}
                                    <a href="{% url 'consulta_detalle' cita.consulta.pk %}"
                                       class="btn btn-sm btn-outline-success btn-action">
                                        <i class="bi bi-clipboard-pulse"></i> Ver Consulta
                                    </a>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <i class="bi bi-check-circle display-1"></i>
                    <h4>No hay citas completadas</h4>
                    <p>Las citas completadas aparecerán aquí.</p>
                </div>
            {% endif %}
        </div>

        <!-- Tab: Canceladas -->
        <div class="tab-pane fade" id="canceladas" role="tabpanel">
            {% if grupos.canceladas %}
                <div class="row">
                    {% for cita in grupos.canceladas %}
                    <div class="col-lg-6 col-xl-4 mb-4">
                        <div class="card cita-card h-100" style="opacity: 0.8;">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h6 class="mb-0">
                                    <i class="bi bi-person me-1"></i>
                                    {{ cita.paciente.nombre_completo }}
                                </h6>
                                <span class="badge bg-danger">{{ cita.get_estado_display }}</span>
                            </div>
                            <div class="card-body">
                                <div class="row mb-2">
                                    <div class="col-6">
                                        <small class="text-muted">Fecha</small>
                                        <div class="fw-bold">{{ cita.fecha_hora|date:"d/m/Y" }}</div>
                                    </div>
                                    <div class="col-6">
                                        <small class="text-muted">Hora</small>
                                        <div class="fw-bold">{{ cita.fecha_hora|time:"H:i" }}</div>
                                    </div>
                                </div>
                                
                                <div class="mb-2">
                                    <small class="text-muted">Médico</small>
                                    <div>{{ cita.medico_asignado.get_full_name|default:"No asignado" }}</div>
                                </div>
                                
                                {% if cita.motivo_cancelacion %}
                                <div class="mb-2">
                                    <small class="text-muted">Motivo de cancelación</small>
                                    <div class="text-truncate">{{ cita.motivo_cancelacion }}</div>
                                </div>
                                {% endif %}
                                
                                <div class="d-flex align-items-center justify-content-between">
                                    <small class="text-muted">
                                        <i class="bi bi-hash"></i>{{ cita.numero_cita }}
                                    </small>
                                    <div class="badge bg-danger">
                                        <i class="bi bi-x-circle"></i> {{ cita.get_estado_display }}
                                    </div>
                                </div>
                            </div>
                            <div class="card-footer">
                                <div class="cita-actions">
                                    <a href="{% url 'citas_detalle' cita.pk %}"
                                       class="btn btn-sm btn-outline-info btn-action">
                                        <i class="bi bi-eye"></i> Ver Detalles
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
</div>
</div>
</div>
