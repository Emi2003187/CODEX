{% load static %}
<div class="modal fade" id="modalReceta" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">Receta médica</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>

      <div class="modal-body p-0" style="height:75vh;">
        <iframe
          id="iframeReceta"
          src=""
          title="Receta PDF"
          class="w-100 h-100 border-0"
        ></iframe>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
        <button type="button" class="btn btn-primary" id="btnImprimirReceta">Imprimir</button>
      </div>
    </div>
  </div>
</div>

<script>
(function() {
  const modal = document.getElementById('modalReceta');
  const iframe = document.getElementById('iframeReceta');
  const btnPrint = document.getElementById('btnImprimirReceta');

  // Cuando se abre el modal, setear el src del iframe con la URL del PDF
  // La URL se inyecta desde el botón "Ver Receta" vía data-atributo
  modal?.addEventListener('show.bs.modal', function (ev) {
    const trigger = ev.relatedTarget;
    if (!trigger) return;
    const pdfUrl = trigger.getAttribute('data-receta-pdf');
    if (pdfUrl && iframe) {
      iframe.src = pdfUrl + "#toolbar=1&navpanes=0";
    }
  });

  // Limpiar el iframe al cerrar para evitar fugas
  modal?.addEventListener('hidden.bs.modal', function () {
    if (iframe) iframe.src = "";
  });

  // Imprimir el contenido del iframe (no window.print())
  btnPrint?.addEventListener('click', function () {
    if (iframe && iframe.contentWindow) {
      iframe.contentWindow.focus();
      iframe.contentWindow.print();
    }
  });
})();
</script>
