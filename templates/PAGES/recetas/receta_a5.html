{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Receta Médica</title>
    <link rel="stylesheet" href="{% static 'css/receta_a5.css' %}">
</head>
<body>
    {% with sv=receta.consulta.signos_vitales %}
    <div id="receta-print-area"
         class="receta"
         data-id="{{ receta.pk }}"
         data-paciente="{{ receta.consulta.paciente|slugify }}"
         data-fecha="{{ receta.fecha_emision|date:'Y-m-d' }}">
        
        <!-- 0 · ENCABEZADO COMPACTO -------------------------------------------------->
        <header class="hdr">
            <span class="sub">RECETA INDIVIDUAL</span>
            <h2>CONSULTORIO MÉDICO</h2>
        </header>

        <!-- 1 · DATOS PACIENTE / CONSULTORIO -------------------------------->
        <section class="data-section">
            <div class="data-row">
                <div class="data-item">
                    <b>Paciente:</b>
                    <span class="rx-symbol">Rx</span>
                    <span>{{ receta.consulta.paciente }}</span>
                </div>
                <div class="data-item right-align">
                    <b>Consultorio:</b> {{ receta.consulta.medico.consultorio.nombre }}
                </div>
            </div>
        </section>

        <!-- 2 · FECHAS ------------------------------------------------------>
        <section class="data-section">
            <div class="data-row">
                <div class="data-item">
                    <b>Fecha:</b> {{ receta.fecha_emision|date:"d/m/Y" }}
                </div>
                <div class="data-item right-align">
                    <b>Válido hasta:</b> {{ receta.fecha_validez|default_if_none:receta.fecha_emision|date:"d/m/Y" }}
                </div>
            </div>
        </section>

        <!-- 3 · MÉDICO ------------------------------------------------------>
        <section class="data-section last-data-section">
            <div class="data-row">
                <div class="data-item">
                    <b>Médico responsable:</b> Dr. {{ receta.consulta.medico.get_full_name }}
                </div>
                <div class="data-item right-align">
                    <b>Cédula Prof.:</b> {{ receta.consulta.medico.cedula_profesional|default:"—" }}
                </div>
            </div>
        </section>

        <!-- 4 · SIGNOS VITALES --------------------------------------------->
        <section class="signos">
            <h4 class="section-title">Signos Vitales y Alergias</h4>
            <table class="signos-table">
                <thead>
                    <tr>
                        <th>T.A.</th>
                        <th>F.C.</th>
                        <th>Temp.</th>
                        <th>Peso</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>{{ sv.tension_arterial|default:"—" }}</td>
                        <td>{{ sv.frecuencia_cardiaca|default:"—" }}</td>
                        <td>{{ sv.temperatura|default:"—" }}</td>
                        <td>{{ sv.peso|default:"—" }}</td>
                    </tr>
                    <tr>
                        <th>Talla</th>
                        <th>Circ. Abd.</th>
                        <th>IMC</th>
                        <th></th> {# Empty header #}
                    </tr>
                    <tr>
                        <td>{{ sv.talla|default:"—" }}</td>
                        <td>{{ sv.circunferencia_abdominal|default:"—" }}</td>
                        <td>{{ sv.imc|default:"—" }}</td>
                        <td></td> {# Empty cell #}
                    </tr>
                </tbody>
            </table>
            <p class="alerg"><b>Alergias:</b> {{ sv.alergias|default:"NEGATIVO" }}</p>
        </section>

        <!-- 5 · MEDICAMENTOS ------------------------------------------------>
        <section class="meds">
            <h4 class="section-title">Medicamentos</h4>
            <ol class="lista-meds">
                {% for m in receta.medicamentos.all %}
                    <li>
                        <b>{{ m.nombre|title }}</b> – Dosis: {{ m.dosis }},
                        Frecuencia: {{ m.frecuencia }},
                        Duración: {{ m.duracion }}{% if m.indicaciones and m.indicaciones != "N/A" %},
                        Indicaciones: {{ m.indicaciones }}{% endif %}
                    </li>
                {% empty %}
                    <li>No hay medicamentos.</li>
                {% endfor %}
            </ol>
        </section>

        <!-- 6 · NOTAS, FIRMA Y PIE (Bloque indivisible) ---------------->
        <div class="bottom-block">
            <section class="obs">
                <div class="obs-box">
                    <span class="obs-title-inner">NOTAS</span>
                    <div class="obs-text">{{ receta.observaciones|default:"" }}</div>
                </div>
            </section>

            <div class="firma-sello">
                <div class="firma-box">
                    <div class="firma-line"></div>
                    <span class="firma-label">Firma</span>
                </div>
                <div class="sello-box">
                    <footer class="pie">
                        Dr. {{ receta.consulta.medico.get_full_name }}<br>
                        CÉDULA PROFESIONAL: {{ receta.consulta.medico.cedula_profesional|default:"—" }} –
                        INSTITUCIÓN: {{ receta.consulta.medico.institucion_cedula|default:"—" }}<br>
                        DIRECCIÓN: {{ receta.consulta.medico.consultorio.ubicacion|default:"—" }}
                    </footer>
                    <span class="sello-label">Sello Profesional</span>
                </div>
            </div>
        </div>
    </div>
    {% endwith %}
</body>
</html>
