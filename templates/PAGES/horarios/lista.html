{% load icons %}
{% extends "base.html" %}
{% block title %}Gestión de Horarios{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2 class="text-primary fw-bold mb-1">Gestión de Horarios</h2>
      <p class="text-muted mb-0">Listado de turnos asignados por consultorio</p>
    </div>
    {% if usuario.rol == "admin" %}
    <a href="{% url 'horarios_crear' %}" class="btn btn-primary d-flex align-items-center shadow-sm">
    {% icon 'calendar-plus' css_class='me-2' %} Crear Horario
    </a>

    {% endif %}
  </div>

  <div class="card shadow-sm border-0 rounded-4">
    <div class="table-responsive">
      <table class="table table-borderless table-hover align-middle mb-0">
        <thead class="bg-light text-secondary border-bottom border-2">
          <tr>
            <th scope="col" class="ps-4">Médico</th>
            <th scope="col">Consultorio</th>
            <th scope="col">Días</th>
            <th scope="col">Hora inicio</th>
            <th scope="col">Hora fin</th>
            {% if usuario.rol == "admin" %}
              <th scope="col" class="text-center">Acciones</th>
            {% endif %}
          </tr>
        </thead>
        <tbody>
          {% if horarios %}
            {% for h in horarios %}
              <tr class="border-bottom">
                <td class="ps-4">
                  <strong>{{ h.medico.get_full_name }}</strong>
                  <br><small class="text-muted">({{ h.medico.rol|title }})</small>
                </td>
                <td>{{ h.consultorio }}</td>
                <td>
                  {% for dia in h.dias %}
                    <span class="badge bg-secondary-subtle text-dark border border-light me-1">{{ dia }}</span>
                  {% endfor %}
                </td>
                <td>
                  <span class="badge bg-info text-white">{{ h.hora_inicio|time:"H:i" }}</span>
                </td>
                <td>
                  <span class="badge bg-info text-white">{{ h.hora_fin|time:"H:i" }}</span>
                </td>
                {% if usuario.rol == "admin" %}
                <td class="text-center">
                  <div class="d-flex justify-content-center gap-2">
                    <a href="{% url 'horarios_editar' h.pk %}" class="btn btn-sm btn-outline-primary d-flex align-items-center">
                      {% icon 'pencil' css_class='me-1' %} Editar
                    </a>
                    <form method="post" action="{% url 'horarios_eliminar' h.pk %}" onsubmit="return confirm('¿Eliminar este horario?');">
                      {% csrf_token %}
                      <button type="submit" class="btn btn-sm btn-outline-danger d-flex align-items-center">
                        {% icon 'trash' css_class='me-1' %} Eliminar
                      </button>
                    </form>
                  </div>
                </td>
                {% endif %}
              </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="{% if usuario.rol == 'admin' %}6{% else %}5{% endif %}" class="text-center py-5 text-muted">
                {% icon 'calendar-x' css_class='fs-4 d-block mb-2' %}
                No hay horarios registrados aún.
              </td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
