{% extends "base.html" %}
{% load static %}
{% load icons %}

{% block title %}Signos Vitales - {{ signos.consulta.paciente.nombre_completo }}{% endblock %}

{% block content %}
<div class="container-fluid">
  <!-- BREADCRUMB -->
  <div class="row mb-4">
    <div class="col-12">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item">
            <a href="{% if usuario.rol == 'admin' %}{% url 'dashboard_admin' %}{% elif usuario.rol == 'medico' %}{% url 'dashboard_medico' %}{% else %}{% url 'dashboard_asistente' %}{% endif %}">
              Dashboard
            </a>
          </li>
          <li class="breadcrumb-item">
            <a href="{% url 'consultas_lista' %}">Consultas</a>
          </li>
          <li class="breadcrumb-item">
            <a href="{% url 'consulta_detalle' signos.consulta.pk %}">Consulta</a>
          </li>
          <li class="breadcrumb-item active">Signos Vitales</li>
        </ol>
      </nav>
    </div>
  </div>

  <!-- HEADER -->
  <div class="row align-items-center mb-4">
    <div class="col-md-8">
      <h1 class="fw-bold text-primary mb-0">
        {% icon 'heart-pulse' css_class='me-2' %}Signos Vitales
      </h1>
      <p class="text-muted mb-0">
        Paciente: <strong>{{ signos.consulta.paciente.nombre_completo }}</strong> 
        ({{ signos.consulta.paciente.edad }} años)
      </p>
    </div>
    <div class="col-md-4 text-md-end mt-3 mt-md-0">
      <div class="d-flex gap-2 justify-content-md-end">
        <a class="btn btn-outline-secondary" href="{% url 'consultas_lista' %}">
          {% icon 'arrow-left' css_class='me-1' %}Volver
        </a>
        {% if usuario.rol in 'medico,asistente,admin' %}
          <a href="{% url 'signos_editar' signos.pk %}?next={{ request.get_full_path }}"
             class="btn btn-warning">
            {% icon 'pencil' css_class='me-1' %}Editar
          </a>
          {% if usuario.rol in 'medico,admin' %}
            <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#eliminarSignosModal">
              {% icon 'trash' css_class='me-1' %}Eliminar
            </button>
          {% endif %}
        {% endif %}
      </div>
    </div>
  </div>

  <!-- INFORMACIÓN DE LA CONSULTA -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card border-0 shadow-sm">
        <div class="card-body">
          <div class="row">
            <div class="col-md-3">
              <small class="text-muted d-block">Fecha de Consulta</small>
              <strong>{{ signos.consulta.fecha_creacion|date:"d/m/Y H:i" }}</strong>
            </div>
            <div class="col-md-3">
              <small class="text-muted d-block">Médico</small>
              <strong>
                {% if signos.consulta.medico %}
                  Dr. {{ signos.consulta.medico.get_full_name }}
                {% else %}
                  Sin asignar
                {% endif %}
              </strong>
            </div>
            <div class="col-md-3">
              <small class="text-muted d-block">Estado de Consulta</small>
              <span class="badge bg-{% if signos.consulta.estado == 'finalizada' %}success{% elif signos.consulta.estado == 'en_progreso' %}primary{% elif signos.consulta.estado == 'espera' %}warning{% else %}secondary{% endif %}">
                {{ signos.consulta.get_estado_display }}
              </span>
            </div>
            <div class="col-md-3">
              <small class="text-muted d-block">Registrado</small>
              <strong>{{ signos.fecha_registro|date:"d/m/Y H:i" }}</strong>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- SIGNOS VITALES -->
  <div class="row">
    <!-- SIGNOS BÁSICOS -->
    <div class="col-lg-6 mb-4">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">
            {% icon 'activity' css_class='me-2' %}Signos Vitales Básicos
          </h5>
        </div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-6">
              <div class="d-flex align-items-center p-3 bg-light rounded">
                <div class="me-3">
                  {% icon 'heart' size=24 css_class='text-danger' %}
                </div>
                <div>
                  <small class="text-muted d-block">Tensión Arterial</small>
                  <strong class="fs-5">{{ signos.tension_arterial|default:"No registrado" }}</strong>
                </div>
              </div>
            </div>
            <div class="col-6">
              <div class="d-flex align-items-center p-3 bg-light rounded">
                <div class="me-3">
                  {% icon 'heart-pulse' size=24 css_class='text-primary' %}
                </div>
                <div>
                  <small class="text-muted d-block">Frecuencia Cardíaca</small>
                  <strong class="fs-5">
                    {% if signos.frecuencia_cardiaca %}
                      {{ signos.frecuencia_cardiaca }} lpm
                    {% else %}
                      No registrado
                    {% endif %}
                  </strong>
                </div>
              </div>
            </div>
            <div class="col-6">
              <div class="d-flex align-items-center p-3 bg-light rounded">
                <div class="me-3">
                  {% icon 'lungs' size=24 css_class='text-info' %}
                </div>
                <div>
                  <small class="text-muted d-block">Frecuencia Respiratoria</small>
                  <strong class="fs-5">
                    {% if signos.frecuencia_respiratoria %}
                      {{ signos.frecuencia_respiratoria }} rpm
                    {% else %}
                      No registrado
                    {% endif %}
                  </strong>
                </div>
              </div>
            </div>
            <div class="col-6">
              <div class="d-flex align-items-center p-3 bg-light rounded">
                <div class="me-3">
                  {% icon 'thermometer' size=24 css_class='text-warning' %}
                </div>
                <div>
                  <small class="text-muted d-block">Temperatura</small>
                  <strong class="fs-5">
                    {% if signos.temperatura %}
                      {{ signos.temperatura }}°C
                    {% else %}
                      No registrado
                    {% endif %}
                  </strong>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- MEDIDAS ANTROPOMÉTRICAS -->
    <div class="col-lg-6 mb-4">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-header bg-success text-white">
          <h5 class="mb-0">
            {% icon 'rulers' css_class='me-2' %}Medidas Antropométricas
          </h5>
        </div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-6">
              <div class="d-flex align-items-center p-3 bg-light rounded">
                <div class="me-3">
                  {% icon 'speedometer2' size=24 css_class='text-success' %}
                </div>
                <div>
                  <small class="text-muted d-block">Peso</small>
                  <strong class="fs-5">
                    {% if signos.peso %}
                      {{ signos.peso }} kg
                    {% else %}
                      No registrado
                    {% endif %}
                  </strong>
                </div>
              </div>
            </div>
            <div class="col-6">
              <div class="d-flex align-items-center p-3 bg-light rounded">
                <div class="me-3">
                  {% icon 'arrows-vertical' size=24 css_class='text-info' %}
                </div>
                <div>
                  <small class="text-muted d-block">Talla</small>
                  <strong class="fs-5">
                    {% if signos.talla %}
                      {{ signos.talla }} m
                    {% else %}
                      No registrado
                    {% endif %}
                  </strong>
                </div>
              </div>
            </div>
            <div class="col-6">
              <div class="d-flex align-items-center p-3 bg-light rounded">
                <div class="me-3">
                  {% icon 'calculator' size=24 css_class='text-primary' %}
                </div>
                <div>
                  <small class="text-muted d-block">IMC</small>
                  <strong class="fs-5">
                    {% if signos.imc %}
                      {{ signos.imc|floatformat:1 }}
                      {% if signos.imc < 18.5 %}
                        <small class="text-info">(Bajo peso)</small>
                      {% elif signos.imc < 25 %}
                        <small class="text-success">(Normal)</small>
                      {% elif signos.imc < 30 %}
                        <small class="text-warning">(Sobrepeso)</small>
                      {% else %}
                        <small class="text-danger">(Obesidad)</small>
                      {% endif %}
                    {% else %}
                      No calculado
                    {% endif %}
                  </strong>
                </div>
              </div>
            </div>
            <div class="col-6">
              <div class="d-flex align-items-center p-3 bg-light rounded">
                <div class="me-3">
                  {% icon 'circle' size=24 css_class='text-warning' %}
                </div>
                <div>
                  <small class="text-muted d-block">Circunferencia Abdominal</small>
                  <strong class="fs-5">
                    {% if signos.circunferencia_abdominal %}
                      {{ signos.circunferencia_abdominal }} cm
                    {% else %}
                      No registrado
                    {% endif %}
                  </strong>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- INFORMACIÓN ADICIONAL -->
    <div class="col-12">
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-info text-white">
          <h5 class="mb-0">
            {% icon 'clipboard-data' css_class='me-2' %}Información Adicional
          </h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6">
              <h6 class="fw-bold text-danger">
                {% icon 'exclamation-triangle' css_class='me-2' %}Alergias del Paciente
              </h6>
              <div class="p-3 bg-light rounded">
                {% if signos.alergias %}
                  <p class="mb-0">{{ signos.alergias }}</p>
                {% else %}
                  <p class="mb-0 text-muted fst-italic">No se registraron alergias</p>
                {% endif %}
              </div>
            </div>
            <div class="col-md-6">
              <h6 class="fw-bold text-primary">
                {% icon 'clipboard-pulse' css_class='me-2' %}Síntomas o Padecimientos Actuales
              </h6>
              <div class="p-3 bg-light rounded">
                {% if signos.sintomas %}
                  <p class="mb-0">{{ signos.sintomas }}</p>
                {% else %}
                  <p class="mb-0 text-muted fst-italic">No se registraron síntomas</p>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal de confirmación para eliminar -->
<div class="modal fade" id="eliminarSignosModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">
          {% icon 'exclamation-triangle' css_class='text-danger me-2' %}
          Confirmar Eliminación
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <p>¿Está seguro de que desea eliminar los signos vitales de este paciente?</p>
        <div class="alert alert-warning">
          {% icon 'warning' css_class='me-2' %}
          <strong>Advertencia:</strong> Esta acción no se puede deshacer. 
          Se perderán todos los datos registrados.
        </div>
        <p><strong>Paciente:</strong> {{ signos.consulta.paciente.nombre_completo }}</p>
        <p><strong>Fecha de registro:</strong> {{ signos.fecha_registro|date:"d/m/Y H:i" }}</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          {% icon 'x-circle' css_class='me-1' %}Cancelar
        </button>
        <form method="post" action="{% url 'signos_eliminar' signos.pk %}" style="display: inline;">
          {% csrf_token %}
          <input type="hidden" name="next" value="{{ volver_a }}">
          <button type="submit" class="btn btn-danger">
            {% icon 'trash' css_class='me-1' %}Eliminar Signos
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

<style>
.card {
  transition: all 0.3s ease;
}

.card:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.bg-light {
  transition: all 0.2s ease;
}

.bg-light:hover {
  background-color: #f8f9fa !important;
  transform: scale(1.02);
}
</style>
{% endblock %}
